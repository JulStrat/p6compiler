<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html><head><meta content="text/html; charset=ISO-8859-1" http-equiv="content-type"><title>MANUAL</title></head><body>
<p style="margin-bottom: 0in; font-family: Arial;" align="center"><big><font style="font-size: 20pt;" size="5"><big><b>P6</b></big></font></big></p>
<p style="margin-bottom: 0in; font-family: Arial;" align="center"><br>
</p>
<p style="margin-bottom: 0in; font-weight: normal; font-family: Arial;" align="center"><font size="4">A
Manual for &#8220;Pascal P6&#8221;,</font></p>
<p style="margin-bottom: 0in; font-weight: normal; font-family: Arial;" align="center"><font size="4">A
Processing System Compliant with ISO 7185, Level 1</font></p>
<p style="margin-bottom: 0in; font-family: Arial;" align="center"><br>
</p>
<p style="margin-bottom: 0in; font-weight: normal; font-family: Arial;" align="center"><font size="3">Release
v1.0</font></p>
<p style="margin-bottom: 0in; font-weight: normal; font-family: Arial;" align="center"><font size="3">March
2017</font></p><br style="font-family: Arial;"><p style="margin-top: 0.17in; page-break-after: avoid; font-family: Arial;"><br><br>
</p>
<p style="margin-top: 0.2in; margin-bottom: 0in; page-break-before: always; font-family: Arial;" align="center"><big>
<font size="4"><big><b>Compliance Statement</b></big></font></big></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-weight: normal; font-family: Arial;" align="left">
&#8220;<font size="3">Pascal P6, v1.0&#8221;
complies with the requirements of level 1 of ISO/IEC 7185.</font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-family: Arial;" align="center"><big>
<font size="4"><big><b>Accompanying Document</b></big></font></big></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-weight: normal; font-family: Arial;" align="left">
<font size="3">This is the &#8220;accompanying document&#8221; or &#8220;accompanying
documentation&#8221; referenced in the ISO/IEC 7185 standard.</font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-family: Arial;" align="center"><big>
<font size="4"><big><b>Getting Started</b></big></font></big></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3"><span style="font-weight: normal;">This manual describes
v1.0 of the &#8220;Pascal P6&#8221; processor.  It is not intended as a
tutorial with which to learn the Pascal language. There are now many
books suitable for studying the language, chief among them the
updated </span></font><font size="3"><u><span style="font-weight: normal;">Pascal
User Manual &amp; Report</span></u></font><font size="3"><span style="font-weight: normal;">
by Kathleen Jensen and Niklaus Wirth. Rather, this manual describes
the &#8220;Pascal P6&#8221; processor, which is the combination of the
compiler (pcom.pas) and an interpreter (pint.pas) for the
intermediate code generated by the compiler.</span></font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-weight: normal; font-family: Arial;" align="left">
<font size="3">To use these sources, one must have a suitable Pascal
compiler with which to compile the compiler and interpreter for the
first time to obtain executable versions of pcom and pint. (The only
executables supplied in the download are pcom.exe and pint.exe, which
are console applications that can run under Windows 7 &amp; 10.) The
GNU Pascal compiler (gpc) is such a &#8220;suitable&#8221; compiler, and is
available for a wide variety of target architectures and operating
systems. The source file &#8220;pcom.pas&#8221; has several
conditionally-compiled sections in it, which allows gpc to produce
the executable 'pcom.exe'. This executable file can be be used to
generate an intermediate code file using a filename listed as the
first argument in the command line that invokes pcom. Both pcom.pas
and pint.pas can be compiled by gpc. The intermediate code file
(&#8220;pcom.p6&#8221; in the supplied batch files), can be used to
self-compile the stripped-down source &#8220;p6com.pas&#8221;.</font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-weight: normal; font-family: Arial;" align="left">
<font size="3">Notice that there are several sequences of
conditionally-compiled code in pcom.pas (that have been left out of
p6com.pas), that looks like: '{$ifdef __GPC__} &lt;source to be
processed by gpc&gt; {$endif}'. This is to handle some very minor
differences between Standard Pascal and GNU Pascal: GNU Pascal
requires an explicit declaration of 'prr' as a textfile, whereas P6
relies on the implementation-defined program parameter listing of
'prr' to handle this. Thus, the gpc-compiled version of pcom does an
explicit 'assign' of the prr textfile, binding it to an external
textfile with the first argument listed in the command line invoking
the compiler. On the other hand, the self-compiled version of
p6com.pas implicitly binds the 'prr' textfile from the program
parameter list to the external file 'prr.txt'. Although this is
implementation-defined, a Standard-compliant program is allowed to
rely on implementation-defined features. Using the enclosed batch
files, the command line invoking the gpc-compiled pcom.exe specifies
the name &#8220;pcom.p6&#8221; for the emitted intermediate code file. A
self-compile is accomplished by invoking a gpc-compiled &#8220;pint&#8221; to
load the &#8220;pcom.p6&#8221; intermediate code file (thereby causing pint
to &#8220;think&#8221; that it is a Pascal compiler) and doing a re-direction
of the &#8220;input&#8221; file to &#8220;p6com.pas&#8221;. In both Unix and a
command-line (formerly &#8220;DOS&#8221;) window under Windows, the command
line looks like &#8220;pint pcom.p6 &lt;p6com.pas&#8221; (or &#8220;pint prr.txt
&lt;p6com.pas&#8221; for the second and subsequent self-compiles). The
fact that the pcom.p6 and the resulting prr.txt files are identical
is proof that the self-compilation is successful.</font></p><p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-weight: normal; font-family: Arial;" align="left"><font size="3"></font></p>
<p style="margin-top: 0.2in; margin-bottom: 0in; page-break-before: always; font-family: Arial;" align="center"><big>
<font size="4"><big><b>Error Handling in P6</b></big></font></big></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-weight: normal; font-family: Arial;" align="left">
<font size="3">For each of the errors
enumerated below (taken from Appendix D of the Standard), the
handling by P6 is indicated by one of the letters A through F below,
corresponding to the adjacent explanation.</font></p>
<p style="text-indent: 0.2in; margin-top: 0.02in; margin-bottom: 0in; font-weight: normal; font-family: Arial;" align="left">
<font size="3">A) The error is always
caught at compile-time.</font></p>
<p style="text-indent: 0.2in; margin-top: 0.02in; margin-bottom: 0in; font-weight: normal; font-family: Arial;" align="left">
<font size="3">B) The error is always
caught at run-time, regardless of the setting of compiler switches.</font></p>
<p style="text-indent: 0.2in; margin-top: 0.02in; margin-bottom: 0in; font-weight: normal; font-family: Arial;" align="left">
<font size="3">C) The error is caught at
run-time, but only when the compiler switch {$d+} is set.</font></p>
<p style="text-indent: 0.2in; margin-top: 0.02in; margin-bottom: 0in; font-weight: normal; font-family: Arial;" align="left">
<font size="3">D) The error is neither
caught at compile-time nor caught at run-time.</font></p>
<p style="text-indent: 0.2in; margin-top: 0.02in; margin-bottom: 0in; font-weight: normal; font-family: Arial;" align="left">
<font size="3">E) A particular undefined
value may or may not be detected, depending on the value.</font></p>
<p style="text-indent: 0.2in; margin-top: 0.02in; margin-bottom: 0in; font-weight: normal; font-family: Arial;" align="left">
<font size="3">F) It depends on how the
Pascal implementation that compiles the interpreter handles it.</font></p>
<p style="text-indent: 0.2in; margin-top: 0.02in; margin-bottom: 0in; font-weight: normal; font-family: Arial;" align="left">
<br>
</p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-weight: normal; font-family: Arial;" align="left">
<font size="3">D.1 6.5.3.2    C</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">For
an indexed-variable closest-containing a single index-expression, it
is an error if the value of the index-expression is not
assignment-compatible with the index-type of the array-type.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.2
6.5.3.3    D</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">It
is an error unless a variant is active for the entirety of each
reference and access to each component of the variant.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.3
6.5.4    C</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">It
is an error if the pointer-variable of an identified-variable denotes
a nil-value.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.4
6.5.4    E</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">It
is an error if the pointer-variable of an identified-variable is
undefined.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.5
6.5.4    D</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">It
is an error to remove from its pointer-type the identifying-value of
an identified-variable when a reference to the identified-variable
exists.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.6
6.5 .5    B</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">It
is an error to alter the value of a file-variable f when a reference
to the buffer-variable f^ exists.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.7
6.6.3.2    C</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">It
is an error if the value of each corresponding actual value parameter
is not assignment compatible with the type possessed by the
formal-parameter.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.8
6.6.3.2    B</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">For
a value parameter, it is an error if the actual-parameter is an
expression of a set-type whose value is not assignment-compatible
with the type possessed by the formal-parameter.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.9
6.6.5.2    B</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">It
is an error if the file mode is not Generation immediately prior to
any use of put, write, writeln or page.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.10
6.6.5.2    B</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">It
is an error if the file is undefined immediately prior to any use of
put, write, writeln or page.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.11
6.6.5.2    B</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">It
is an error if end-of-file is not true immediately prior to any use
of put, write, writeln or page.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.12
6.6.5.2    D</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">It
is an error if the buffer-variable is undefined immediately prior to
any use of put.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.13
6.6.5.2    B</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">It
is an error if the file is undefined immediately prior to any use of
reset.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.14
6.6.5.2    B</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">It
is an error if the file mode is not Inspection immediately prior to
any use of get or read.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.15
6.6.5.2    B</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">It
is an error if the file is undefined immediately prior to any use of
get or read.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.16
6.6.5.2    B</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">It
is an error if end-of-file is true immediately prior to any use of
get or read.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.17
6.6.5.2    B</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">For
read, it is an error if the value possessed by the buffer-variable is
not assignment compatible with the variable-access.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.18
6.6.5.2    B</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">For
write, it is an error if the value possessed by the expression is not
assignment-compatible with the buffer-variable.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.19
6.6.5.3    D</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">For
new(p,c</font><sub><font size="3">1</font></sub><font size="3">,
. . .,c</font><sub><font size="3">n</font></sub><font size="3">),
it is an error if a variant of a variant-part within the new variable
becomes active and a different variant of the variant-part is one of
the specified variants.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.20
6.6.5.3    D</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">For
dispose(p), it is an error if the identifying-value had been created
using the form new(p, c</font><sub><font size="3">1</font></sub><font size="3">,
. . .,c</font><sub><font size="3">n</font></sub><font size="3">
).</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.21
6.6.5.3    D</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">For
dispose(p, k</font><sub><font size="3">1</font></sub><font size="3">,
. . ., k</font><sub><font size="3">n</font></sub><font size="3">
), it is an error unless the variable had been created using the form
new(p ,c</font><sub><font size="3">1</font></sub><font size="3">,
. . .,c</font><sub><font size="3">m</font></sub><font size="3">)
and m is equal to n.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.22
6.6.5.3    D</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">For
dispose(p, k</font><sub><font size="3">1</font></sub><font size="3">,
. . ., k</font><sub><font size="3">n</font></sub><font size="3">),
it is an error if the variants in the variable identified by the
pointer value of p are different from those specified by the
case-constants k</font><sub><font size="3">1</font></sub><font size="3">,
. . ., k</font><sub><font size="3">n</font></sub><font size="3">.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.23
6.6.5.3    B</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">For
dispose, it is an error if the parameter of a pointer-type has a
nil-value.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.24
6.6.5.3    E</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">For
dispose, it is an error if the parameter of a pointer-type is
undefined.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.25
6.6.5.3    Huh?</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">It
is an error if a variable created using the second form of new is
accessed by the identified variable of the variable-access of a
factor, of an assignment-statement, or of an actual-parameter.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.26
6.6.5.4    D</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">For
pack, it is an error if the parameter of ordinal-type is not
assignment-compatible with the index-type of the unpacked array
parameter.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.27
6.6.5.4    D</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">For
pack, it is an error if any of the components of the unpacked array
are both undefined and accessed.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.28
6.6.5.4    D</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">For
pack, it is an error if the index-type of the unpacked array is
exceeded.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.29
6.6.5.4    D</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">For
unpack, it is an error if the parameter of ordinal-type is not
assignment-compatible with the index-type of the unpacked array
parameter.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.30
6.6.5.4    D</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">For
unpack, it is an error if any of the components of the packed array
are undefined.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.31
6.6.5.4    D</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">For
unpack, it is an error if the index-type of the unpacked array is
exceeded.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.32
6.6.6.2    F</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">Sqr(x)
computes the square of x . It is an error if such a value does not
exist.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.33
6.6.6.2    F</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">For
ln(x), it is an error if x is not greater than zero.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.34
6.6.6.2    F</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">For
sqrt(x), it is an error if x is negative.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.35
6.6.6.3    F</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">For
trunc(x), the value of trunc(x) is such that if x is positive or zero
then 0 &lt; x-trunc(x) &lt; 1; otherwise 1 &lt;x- trunc(x) &lt; 0 .
It is an error if such a value does not exist.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.36
6.6.6.3    F</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">For
round(x), if x is positive or zero then round(x) is equivalent to
trunc(x+0 .5), otherwise round(x) is equivalent to trunc(x- 0 .5) .
It is an error if such a value does not exist.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.37
6.6.6.3    C</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">For
chr(x), the function returns a result of char-type that is the value
whose ordinal number is equal to the value of the expression x if
such a character value exists . It is an error if such a character
value does not exist.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.38
6.6.6.4    C</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">For
succ(x), the function yields a value whose ordinal number is one
greater than that of x, if such a value exists . It is an error if
such a value does not exist.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.39
6.6.6.4    C</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">For
pred(x), the function yields a value whose ordinal number is one less
than that of x, if such a value exists . It is an error if such a
value does not exist.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.40
6.6.6.5    B</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">When
eof(f) is activated, it is an error if f is undefined .</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.41
6.6.6.5    B</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">When
eoln(f) is activated, it is an error if f is undefined.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.42
6.6.6.5    B</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">When
eoln(f) is activated, it is an error if eof(f) is true.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.43
6.7.1    D</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">An
expression denotes a value unless a variable denoted by a
variable-access contained by the expression is undefined at the time
of its use, in which case that use is an error.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.44
6.7.2.2    B</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">A
term of the form x/y is an error if y is zero.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.45
6.7.2.2    B</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">A
term of the form i div j is an error if j is zero.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.46
6.7.2.2    B</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">A
term of the form i mod j is an error if j is zero or negative.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.47
6.7.2.2    A</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">It
is an error if an integer operation or function is not performed
according to the mathematical rules for integer arithmetic.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.48
6.7.3    D</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">It
is an error if the result of an activation of a function is undefined
upon completion of the algorithm of the activation.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.49
6.8.2.2    A</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">For
an assignment-statement, it is an error if the expression is of an
ordinal-type whose value is not assignment-compatible with the type
possessed by the variable or function-identifier.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.50
6.8.2.2    B</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">For
an assignment-statement, it is an error if the expression is of a
set-type whose value is not assignment-compatible with the type
possessed by the variable.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.51
6.8.3.5    B</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">For
a case-statement, it is an error if none of the case-constants is
equal to the value of the case-index upon entry to the
case-statement.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.52
6.8.3.9    C</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">For
a for-statement, it is an error if the value of the initial-value is
not assignment-compatible with the type possessed by the
control-variable if the statement of the for-statement is executed.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.53
6.8.3.9    C</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">For
a for-statement, it is an error if the value of the final-value is
not assignment-compatible with the type possessed by the
control-variable if the statement of the for-statement is executed.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.54
6.9.1    F</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">On
reading an integer from a textfile, after skipping preceding spaces
and end-of-lines, it is an error if the rest of the sequence does not
form a signed-integer.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.55
6.9.1    C</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">On
reading an integer from a textfile, it is an error if the value of
the signed-integer read is not assignment-compatible with the type
possessed by variable-access.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.56
6.9.1    F</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">On
reading a number from a textfile, after skipping preceding spaces and
end-of-lines, it is an</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">error
if the rest of the sequence does not form a signed-number.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.57
6.9.1    D</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">It
is an error if the buffer-variable is undefined immediately prior to
any use of read.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.58
6.9.3.1    C</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">On
writing to a textfile, the values of TotalWidth and FracDigits are
greater than or equal to one; it is an error if either value is less
than one.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.59
6.10    F</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">The
execution of any action, operation, or function, defined to operate
on a variable, is an error if the variable is a program-parameter
and, as a result of the binding of the program-parameter, the
execution cannot be completed as defined.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">D.60
6.6.3.8    A</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left"><font size="3">For
a conformant array, it is an error if the smallest or largest value
specified by the index-type of the actual-parameter lies outside the
closed interval specified by the index-type-specification of the
conformant-array-schema.</font></p>
<p style="margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;"><br>
</p>
<p style="margin-bottom: 0in; page-break-before: always; font-family: Arial;" align="center"><big>
<font size="4"><big><b>Implementation-defined
Features</b></big></font></big></p>

<p style="margin-bottom: 0in; font-family: Arial;" align="left"><font size="3"><span style="font-weight: normal;">The
Standard (ISO/IEC 7185) lists in its Appendix E, a list of features
that are &#8220;implementation-defined&#8221; and requires that an
accompanying document for a compliant processor explain how the
processor does for each such feature: The outline number following
each &#8220;E.n&#8221; tells where in the Standard the feature is referenced.
A non-italicized text (from the Standard) briefly describes the
feature. This is followed by </span></font><font size="3"><i><span style="font-weight: normal;">italicized
text</span></i></font><font size="3"><span style="font-weight: normal;">
which describes how P6 handles the feature. A program that complies
with ISO/IEC 7185 is allowed to use an implementation-defined
feature, despite the fact that the behavior of the program might vary
from processor to processor.</span></font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-weight: normal; font-family: Arial;" align="left">
<font size="3">E.1 6.1.7</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">The string-characters
which denote an implementation-defined value of the required char
type.</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">NOTE --- For processors
which compile and execute in different environments, the above may
require the definition of two character sets and a mapping between
the two.</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3"><i>The P6 Pascal compiler
assumes that the sets ['a'..'z'] and ['A',,'Z'] each have 26 elements
in them. This is not true of all character sets (e.g., EBCDIC). It
also assumes that the braces ('{' and '}') are present in the
character set, although the digraphs &#8220;(*&#8221; and &#8220;*)&#8221; can be
substituted for them. Similarly, P6 assumes the presence of the
square brackets &#8220;[&#8220; and &#8220;]&#8221;, although the digraphs &#8220;(.&#8221;
and &#8220;.)&#8221; can be substituted. Although the &#8220;upward arrow&#8221;
(&#8220;</i></font><font size="3"><i>&#8593;</i></font><font size="3"><i>&#8220;)
is not generally shown as such in the ASCII character set (used to
indicate de-referencing of pointers, and for denoting a file buffer
variable), both the &#8220;caret&#8221; (&#8220;^&#8221;) and the &#8220;at sign&#8221; (&#8220;@&#8221;)
can be used to represent it. Thus, P6 supports a computer system that
supports the ISO 646:1983 standard, which is equivalent to the ANSI
ASCII character set standard.</i></font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3"><i>The compiler source
(pcom.pas) and the interpreter source (pint.pas) are both ASCII
textfiles. There may be some target computers that do not use a
character set compatible with ISO 646. That would make the
bootstrapping of P6 considerably more challenging.</i></font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">E.2 6.1.9</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">Provision of the
reference tokens </font><font size="3">&#8593;</font><font size="3">,
[, and ], of the alternative token @, and of the delimiting
characters { and }, is implementation-defined.</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3"><i>See the above comment
for E.1.</i></font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">E.3 6.4.2.2b)</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">The values of the
implementation-defined approximation to an implementation-defined
subset of the real numbers denoted by signed-real.</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">NOTE --- The subset
defined above may be by reference to another specification.</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3"><i>P6 &#8220;piggybacks&#8221;
off the Pascal implementation that compiles the interpreter.
Generally, such an implementation will use the underlying hardware
support for floating-point arithmetic. If there is no hardware
support, then a software-simulated floating-point library is usually
provided.</i></font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">E.4 6.4.2.2d)</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">The values of char-type
which are an enumeration of a set of implementation-defined
characters.</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3"><i>See the comment for
E.1.</i></font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">E.5 6.4.2.2d)</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">The ordinal numbers of
each value of char-type are implementation-defined.</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3"><i>See the comment for
E.1. For the ASCII character set, the ordinal values of the printable
set of characters lies in the closed interval 32 (space) to 126
(tilde).</i></font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">E.6 6.4.3.5</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">The set of characters
designated prohibited from textfiles is implementation-defined.</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3"><i>There may be
restrictions placed on characters in textfiles for particular target
architectures and/or target operating systems, on a case-by-case
basis. P6 itself has no such restrictions; it allows a program to
write any character, from chr(0) to chr(255), to a textfile.</i></font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">E.7 6.6.5.2</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">The point at which the
file operations rewrite, put, reset, and get are actually performed
is implementation-defined.</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3"><i>This is dependent on
the underlying operating system of the target. By and large, the file
operations listed above are performed before the execution of the
following Pascal statement, so that the semantics of ISO/IEC 7185 are
preserved.</i></font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">E.8 6.7.2.2</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">The value denoted by the
constant-identifier maxint is implementation-defined.</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3"><i>It certainly is! In
P6, the integer is defined to be a 32-bit, 2's-complement number.
Therefore, the value of maxint is </i></font><font size="3"><i>2147483647.
(That was an easy one.)</i></font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">E.9 6.7.2.2</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">The accuracy of the
approximation of the result of the real operations and functions to
the mathematical result is implementation-defined.</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3"><i>See the comment for
E.3.</i></font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">E.10 6.9.3.1</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">The default value of
TotalWidth for integer-type is implementation-defined.</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3"><i>The default value of
TotalWidth for integer is 1. This value is a constant definition in
the compiler (pcom.pas) and can be changed.</i></font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">E.11 6.9.3.1</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">The default value of
TotalWidth for real-type is implementation-defined.</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3"><i>The default value of
TotalWidth for real is 22. This value is a constant definition in the
compiler (pcom.pas) and can be changed.</i></font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">E.12 6.9.3.1</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">The default value of
TotalWidth for Boolean-type is implementation-defined.</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3"><i>The default value of
TotalWidth for Boolean is 5. This value is a constant definition in
the compiler (pcom.pas) and can be changed.</i></font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">E.13 6 .9.3.4.1</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">The value of ExpDigits is
implementation-defined.</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3"><i>This value depends on
the the Pascal implementation that compiles the interpreter. For the
gpc (GNU Pascal compiler) that runs on Windows, the value of
ExpDigits is 2.</i></font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">E.14 6.9.3.4.1</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">The value of the exponent
character (`e' or `E') used on output of values of real-type is
implementation-defined.</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3"><i>This value depends on
the the Pascal implementation that compiles the interpreter. For the
gpc that runs on Windows, the exponent character is the lower-case
'e'.</i></font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">E.15 6 .9 .3 .5</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">The case of each
character of 'True' and 'False' used on output of values of
Boolean-type is implementation-defined.</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3"><i>These values depend on
the the Pascal implementation that compiles the interpreter. For the
gpc that runs on Windows, the value true is written as 'True', and
the value false is written as 'False'. So the first letter is
capitalized, but the rest are in lowercase.</i></font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">E.16 6.9.5</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">The effect of the
procedure page when applied to a textfile which is in generation mode
is implementation-defined.</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3"><i>The P6 interpreter
writes chr(12) to the textfile. That character in the ASCII character
set is the 'form feed'.</i></font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">E.17 6 .10</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">The binding of a
file-type program-parameter is implementation-defined.</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3"><i>The P6 interpreter
calls the 'assign' procedure, which is an extension found in most
Pascal implementations (which would be used to compile the
interpreter), and passes a string which is a concatenation of the
program-parameter identifier and the suffix '.txt'. If the first file
operation on the program-parameter implies Inspection mode, then the
interpreter will call 'reset' and any existing textfile of the
'assign'ed name will be opened for reading. Or if the first file
operation is a 'write' ('writeln' or 'page'), the interpreter will
call 'rewrite' and a new file of the 'assign'ed name will be
generated.</i></font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">E.18 6.10</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">The effect of reset and
rewrite on the standard files input and output is
implementation-defined</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3"><i>The P6 interpreter
ignores such operations.</i></font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="center">
<br>
</p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-style: normal; page-break-before: always; font-family: Arial;" align="center"><big>
<font size="4"><big><b>Implementation-dependent
Features</b></big></font></big></p>

<p style="margin-bottom: 0in; font-family: Arial;" align="left"><font size="3"><span style="font-weight: normal;">The
Standard (ISO/IEC 7185) lists in its Appendix F, the features that
are &#8220;implementation-defined&#8221; and requires that an accompanying
document for a compliant processor explain how the processor does for
each such feature: The outline number following each &#8220;F.n&#8221; tells
where in the Standard the feature is referenced. A non-italicized
text (from the Standard) briefly describes the feature. This is
followed by </span></font><font size="3"><i><span style="font-weight: normal;">italicized
text</span></i></font><font size="3"><span style="font-weight: normal;">
which describes how P6 handles the feature. A program that complies
with ISO/IEC 7185 is not allowed to use an implementation-defined
feature. (Pcom.pas </span></font><font size="3"><i><span style="font-weight: normal;">implements</span></i></font><font size="3"><span style="font-weight: normal;">
the 'commandline' program parameter (F.10), but it does not </span></font><font size="3"><i><span style="font-weight: normal;">use</span></i></font><font size="3"><span style="font-weight: normal;">
this feature in its own code; it lists 'prr' as a program parameter,
but uses it as an textfile, so that is an implementation-</span></font><font size="3"><i><span style="font-weight: normal;">defined</span></i></font><font size="3"><span style="font-weight: normal;">
feature.)</span></font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">F.1 6.4.3.5</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">For any textfile t, the
effect of attributing to a component of either t.L or t.R a member of
the characters prohibited from textfiles is implementation-dependent.</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3"><i>Since there are no
&#8220;prohibited&#8221; characters (see E.6), this is moot.</i></font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">F.2 6.5.3.2</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">The order of evaluation
of the index-expressions of an indexed-variable is
implementation-dependent.</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3"><i>The evaluation is
always left-to-right.</i></font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">F.3 6.7.1</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">The order of evaluation
of expressions of a member-designator is implementation-dependent.</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3"><i>The evaluation is
always left-to-right.</i></font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">F.4 6.7.1</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">The order of evaluation
of the member-designators of a set-constructor is
implementation-dependent.</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3"><i>The evaluation is
always left-to-right.</i></font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">F.5 6.7.2.1</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">The order of evaluation
of the operands of a dyadic operator is implementation-dependent.</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3"><i>The evaluation is
always left-to-right.</i></font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">F.6 6.7.3</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">The order of evaluation,
accessing, and binding of the actual-parameters of a
function-designator is implementation-dependent.</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3"><i>The evaluation,
accessing and binding is always left-to-right.</i></font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">F.7 6.8.2.2</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">The order of accessing
the variable and evaluating the expression of an assignment-statement
is implementation-dependent.</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3"><i>First the
left-hand-side is accessed, then the expression is evaluated.</i></font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">F.8 6.8.2.3</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">The order of evaluation,
accessing, and binding of the actual-parameters of a procedure
statement is implementation-dependent.</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3"><i>The evaluation,
accessing, and binding is always left-to-right.</i></font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">F.9 6.9.5</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">The effect of inspecting
a textfile to which the page procedure was applied during generation
is implementation-dependent.</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3"><i>Doing a get of a
textfile where the page procedure was applied will result in the file
buffer having a chr(12) value. This is the ASCII 'form feed' control
character.</i></font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">F.10 6.10</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3">The binding of non-file
variables denoted by the program-parameters to entities external to
the program is implementation-dependent.</font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3"><i>There is only one case
where this occurs: the pre-declared identifier &#8220;commandline&#8221;
occurring as a program-parameter will cause commandline to be a
pointer to a variable of type &#8220;PACKED ARRAY [1..255] OF char&#8221;.
The array will have a copy of the command line that invoked the
compiler, terminated by a chr(0). Calling dispose(commandline) will
subsequently erase this string. Any other identifier occurring as a
program-parameter will be assumed to be a textfile.</i></font></p>
<p style="margin-right: 0.2in; margin-top: 0.1in; margin-bottom: 0in; font-style: normal; page-break-before: always; font-family: Arial;" align="center"><big>
<font size="4"><big><b>Appendix A. The
P-codes</b></big></font></big></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">This appendix provides a
description of the intermediate language (&#8220;p-codes&#8221;) produced by
the front-end (pcom) and assembled and interpreted by the interpreter
(pint).</font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">There are actually two
such intermediate languages: the first corresponds to the enumeration
definition found in the compiler (pcom.pas, lines 274-289):</font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">opcodes   = ( invd,
{ 0 should always be an invalid opcode }</font></p>
<p style="text-indent: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
              <font size="3">logb,
logw, logd, logm, lolb, lolw, lold, lolm,</font></p>
<p style="text-indent: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
              <font size="3">loib,
loiw, loid, loim, locw, locr, locs, loca,</font></p>
<p style="text-indent: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
              <font size="3">stgb,
stgw, stgd, stgm, stlb, stlw, stld, stlm,</font></p>
<p style="text-indent: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
              <font size="3">stib,
stiw, stid, stim, iand, ior,  flt2, inot,</font></p>
<p style="text-indent: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
              <font size="3">addi,
subi, muli, divi, negi, absi, sqri, modi,</font></p>
<p style="text-indent: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
              <font size="3">addr,
subr, mulr, divr, negr, absr, sqrr, flt,</font></p>
<p style="text-indent: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
              <font size="3">trc, 
rnd,  incw, decw, icgw, iclw, dcgw, dclw,</font></p>
<p style="text-indent: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
              <font size="3">equ, 
neq,  leq,  geq,  les,  gtr,  inn,  dif,</font></p>
<p style="text-indent: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
              <font size="3">equm,
neqm, leqm, geqm, lesm, gtrm, sst1, sst2,</font></p>
<p style="text-indent: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
              <font size="3">tjp, 
ujc,  xjp,  sjp,  cas,  chk0, chk1, chk2,</font></p>
<p style="text-indent: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
              <font size="3">lag, 
lal,  lpa,  lip,  ixa,  ixca, iodd, fjp,</font></p>
<p style="text-indent: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
              <font size="3">eofp,
sgs,  rgs,  bra,  ipj,  dmp,  dup,  swp,</font></p>
<p style="text-indent: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
              <font size="3">cal, 
cali, csp,  mst,  ent,  ret0, ret1, ret2,</font></p>
<p style="text-indent: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
              <font size="3">mov, 
copy, fbv,  fvb,  efb,  pack, unpk, pop0,</font></p>
<p style="text-indent: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
              <font size="3">cmln,
asgn, srcl, fatl, stop, lastop);</font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">These are generated by
the compiler (pcom.pas) and read by the assembler/interpreter
(pint.pas). The second one corresponds to the enumeration definition
found in the interpreter (pint.pas, lines 144-167):</font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">opcodes   = ( invd,
{ 0 should always be an invalid opcode }</font></p>
<p style="text-indent: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">{ row  1 }    logb,
logw, logd, logm, lolb, lolw, lold, lolm,</font></p>
<p style="text-indent: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">{ row  2 }    loib,
loiw, loid, loim, locw, locr, locs, loca,</font></p>
<p style="text-indent: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">{ row  3 }    stgb,
stgw, stgd, stgm, stlb, stlw, stld, stlm,</font></p>
<p style="text-indent: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">{ row  4 }    stib,
stiw, stid, stim, iand, ior,  flt2, inot,</font></p>
<p style="text-indent: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">{ row  5 }    addi,
subi, muli, divi, negi, absi, sqri, modi,</font></p>
<p style="text-indent: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">{ row  6 }    addr,
subr, mulr, divr, negr, absr, sqrr, flt,</font></p>
<p style="text-indent: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">{ row  7 }    trc, 
rnd,  incw, decw, icgw, iclw, dcgw, dclw,</font></p>
<p style="text-indent: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">{ row  8 }    equ, 
neq,  leq,  geq,  les,  gtr,  inn,  dif,</font></p>
<p style="text-indent: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">{ row  9 }    equm,
neqm, leqm, geqm, lesm, gtrm, sst1, sst2,</font></p>
<p style="text-indent: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">{ row 10 }    tjp, 
ujc,  xjp,  sjp,  cas,  chk0, chk1, chk2,</font></p>
<p style="text-indent: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">{ row 11 }    lag, 
lal,  lpa,  lip,  ixa,  ixca, iodd, fjp,</font></p>
<p style="text-indent: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">{ row 12 }    eofp,
sgs,  rgs,  bra,  ipj,  dmp,  dup,  swp,</font></p>
<p style="text-indent: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">{ row 13 }    cal, 
cali, csp,  mst,  ent,  ret0, ret1, ret2,</font></p>
<p style="text-indent: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">{ row 14 }    mov, 
copy, fbv,  fvb,  efb,  pack, unpk, pop0,</font></p>
<p style="text-indent: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">{ row 15 }    cmln,
asgn, srcl, fatl, stop,</font></p>
<p style="text-indent: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
                <font size="3">{
and here's a few opcodes only used in the</font></p>
<p style="text-indent: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
                  <font size="3">assembler/interpreter:
}</font></p>
<p style="text-indent: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">{ row 16 }    locq,
loc0, loc1,</font></p>
<p style="text-indent: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">{ row 17 }    loib0,
loiw0, loid0, loim0,</font></p>
<p style="text-indent: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">{ row 18 }    stib0,
stiw0, stid0, stim0,</font></p>
<p style="text-indent: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">{ row 19 }    lolw0,
stlw0, { same as lolw/stlw except w/ lex=0 }</font></p>
<p style="text-indent: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
                 <font size="3">{
that's all folks }</font></p>
<p style="text-indent: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
                 <font size="3">lastop);</font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">Notice that the second is
a superset of the first, adding thirteen opcodes used only in pint,
between 'stop' and 'lastop'. The purpose of the additional opcodes is
to reduce the size of the resultant interpreted code. The
self-compiled pcom takes less than 50 kilobytes of 'code' (not
including the constant pool, which is loaded into the data space).</font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">The underlying P-machine
is a stack machine very close to what was designed by Niklaus Wirth
and his students at ETH. Most of the differences are in the names of
the opcodes. I couldn't understand the naming convention of the
original set of p-codes, so I overhauled everything to (hopefully)
put more consistency in their names.</font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">The stack machine, by the
way, is one of several possible ones that can be constructed just by
changing a handful of constants. (That's one of the reasons why
software is superior to hardware. No messy wire-routing problems is
another.) All of the 'virtual' machines that execute p-codes are
byte-addressable and use 2's-complement arithmetic. They differ in
the sizes of the stack elements, in the sizes of data addresses and
in the sizes of code addresses. The p-machine for the P6 v1.0 release
is nearly identical to that of Scott Moore's P5 release: it differs
in the size of code addresses (and the additions and naming of
opcodes). P5 uses 32-bit code addresses, while P6 uses only 16-bit
code addresses and offsets. But, like P5, integers are 32 bits; reals
are 64 bits; and data addresses (and so also the 'pointer' data type)
are 32 bits. It also differs in having separate data and code spaces.</font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">It's possible to make a
smaller machine, one with 16-bit integers and pointers, and 32-bit
reals. One of our agenda items is to have that p-machine ready for
the v2.0 release. It is also possible to make a larger machine with
64-bit addresses and pointers. This would run in Intel's x64 mode on
their latest generation of processors.</font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">Is your coffee mug full?
Now is a good time to get it topped off. Ready? Here goes . . .</font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3"><span style="font-style: normal;"><span style="font-weight: normal;">The
first opcode is 'invd', i.e., </span></span></font><font size="3"><i><span style="font-weight: normal;">invalid</span></i></font><font size="3"><span style="font-style: normal;"><span style="font-weight: normal;">.
It is not so important for interpretive code, but it corrects a
problem that hardware engineers had in the design of new
architectures, where they would allow a stream of zero bytes to have
a valid interpretation for the central processing unit (CPU). If
there was a problem where the CPU erroneously got into a data space
and started executing blocks of data with lots of zeros, then
typically the CPU would start adding register 0 to itself over, and
over, and over . . . instead of halting immediately.</span></span></font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">Consider now all the
opcodes in rows 1, 2, 16, 17, and the first one in row 19. They all
start with 'lo', and only differ in the third and fourth letters.
These are the 'load data' instructions. The third letter is either
'g', 'l', 'i', or 'c'. The 'g' stands for 'global'. All variables
declared in the outer block of a program are allocated in the global
data space. They start at address zero in the data space.</font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3"><span style="font-style: normal;"><span style="font-weight: normal;">The
'l' stands for 'local'. Variables declared in a procedure (or
</span></span></font><font size="3"><i><span style="font-weight: normal;">function</span></i></font><font size="3"><span style="font-style: normal;"><span style="font-weight: normal;">,
which we'll lump in with the procedures) have a scope which is that
procedure and any procedures declared within that procedure. Within
the defining procedure, the data is accessed with an offset added to
the stack frame pointer (FP). These variables can also be accessed in
the code of 'nested' procedures by using the chain of static-level
pointers to get to the right lexical level (so that the temporary
frame pointer is the same as the FP mentioned above) and applying the
same offset. The 'load local data' instruction (beginning 'lol',
don't laugh) has a lexical level field following the opcode that
tells how many 'static links' must be accessed to get to the correct
addressing level. To access data declared in the same procedure as
the code, that field is zero, which simply means &#8220;use the
p-machine's FP&#8221;.</span></span></font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">The 'i' in a load
instruction stands for 'indirect'. This means that the datum is
accessed through a 'pointer' which is on the top-of-stack (TOS). The
address on the TOS is popped (and, depending on the opcode, possibly
an offset is applied) to obtain the final address of the datum.</font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">Finally, the 'c' stands
for 'constant'. The instruction loads ('pushes') a constant value
onto the TOS, where the constant value is contained, encoded or
implied within the instruction. So the p-machine can load ('push')
global, local, or indirect data, or constants to the TOS.</font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">The fourth letter of load
data instructions (you didn't forget about the fourth, did you?) is
either a 'b', 'w', 'd' or 'm', indicating the size of the datum being
transferred: 'byte', 'word', 'double', or 'multi-byte'. A byte is
always an 8-bit datum; a word is the basic machine word used for most
arithmetic, logical, and stack operations and depends on the
'virtual' machine definition. For P6 v1.0, it is 32 bits. A 'double'
is always twice the size of a 'word' for a particular virtual
machine, so for P6 v1.0, it is 64 bits. For the smaller virtual
machine mentioned above, the 'word' and 'double' would be 16- and
32-bit data respectively. If the size indicator is 'm', then the
length is encoded  (NS32000-style) after the opcode.</font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">The fourth letter of load
constant instructions ('loc') is either 'w', 'r', 's', or 'a'. The
'w' stands for 'word', so is a 32-bit value (or 16-bit for the
smaller virtual machine). The 'r' stands for a 'real' constant and is
the same size as 'double'. The assembly code generated by the
compiler uses the same text for the real constant as is found in the
source code. The assembly phase of pint does a (Pascal) 'read' of
this constant from the intermediate-code file and stores the constant
in the constant pool section of the data area. The address (index
into the data segment) of this constant pool entry is assembled into
the interpreted instruction. The same goes for 's', which stands for
a 'set' constant. The 'a' stands for 'address' and is used to load
the address of a string (stored in the constant pool) onto the stack.</font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">Then there are the
variant versions of 'load constant' instructions used by the
interpreter. First notice that there are no 'locb' or 'locd'
instructions. The byte sizes exist in memory, but not on the stack,
which must always be 'word' aligned. So 'char' and 'Boolean' data are
always zero-extended to 'word' length before being pushed onto the
TOS. The 'real' type is the only user (for the current virtual
machine) of 'double' data size, so the 'locr' instruction takes the
place of the absent 'locd'. Since 4 billion constant values can be
onto the stack using the 'locw' instruction, this is the one most
favored by the compiler.</font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">Notice, however, the
'locw' instruction is always five bytes long (in the current virtual
machine). This is quite a chunk of space for some of the most
frequent instructions. The assembler (first phase of pint) will look
at the value of the constant being loaded by the 'locw', and
generally reduce it's size by substituting smaller opcodes for the
most frequent small values. Thus 'locw 0' is turned into the 1-byte
instruction 'loc0'. Similarly 'locw 1' is turned into 'loc1'. For
'locw n', where n is a constant in the range -64..63, a two-byte
version of 'locq' ('load constant quick) is used. For n in the range
-8192..8191, a three-byte version of 'locq' is substituted. If n
doesn't lie within these ranges, then the 5-byte 'locw' is used.</font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3"><span style="font-style: normal;"><span style="font-weight: normal;">However,
this technique is used to shorten many instructions which always used
to have a 4-byte length or offset field. These instructions use the
'q' (quick) encoding when it is known that the value must lie within
-2</span></span></font><sup><font size="3"><span style="font-style: normal;"><span style="font-weight: normal;">29</span></span></font></sup><font size="3"><span style="font-style: normal;"><span style="font-weight: normal;">..2</span></span></font><sup><font size="3"><span style="font-style: normal;"><span style="font-weight: normal;">29</span></span></font></sup><font size="3"><span style="font-style: normal;"><span style="font-weight: normal;">-1.
The field is shortened to 1 byte for -64..63, and to 2 bytes for
-8192..8191. This clever encoding scheme was invented by the
designers of the National Semiconductor NS32000 series of processors.
It is being 'borrowed' for the P6 implementation. Thanks, you
anonymous clever people. The 'offset' fields in all the 'load/store
data' instructions use these 'quick' encodings.</span></span></font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">OK, back to opcodes.
(Need more coffee?) Look now at row 17. It was noticed that the most
common offset for the 'load indirect' instructions was zero. So four
additional opcodes are available which encode in a single byte what
used to take two.</font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">And now look at the first
two opcodes in row 11, 'lal' and 'lag'. They are the 'load address'
instructions (for 'local' and 'global'). They use the 'lexical level'
field and offset ('lal'), or just the offset ('lag') to develop an
address which is pushed onto the TOS. Since offsets use the 'quick'
encoding, the 'lag' is functionally the same as the 'locq'
instruction. But the clarity of having a 'load address global'
instruction justifies burning an extra opcode. The third and fourth
opcodes in that row, 'lpa' and 'lip' load a pair of pointers: 1) a
procedure entry point, and 2) a lexical level pointer for that
procedure. The first one loads an 'actual' procedure pair, while the
second loads a 'formal' pair, already existing as a formal parameter.</font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">Take a look at all the
opcodes in row 3 and the first four in row 4. They are spelled the
same way as the opcodes two rows above them, except the letters 'st'
replace 'lo'. Congratulations, you guessed correctly! Yes, those are
the corresponding 'store' instructions. (Did someone just ask why
there are no 'store constant' instructions? See me afterward so I can
sign your drop card.)</font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">Row 18 has shorter 'store
indirect' instructions, analogous to those in row 17, and for the
same reason: it was found empirically that the most common offset is
zero. The two opcodes in row 19 shorten corresponding 'lolw' and
'stlw' opcodes that have a zero lexical level field (which is the
overwhelming majority of them).</font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3"><span style="font-style: normal;"><span style="font-weight: normal;">That
takes care of most of the data transfer instructions. The other
opcodes are far less organized. The final four opcodes in row 4 are
the two dyadic Boolean operators 'iand' and 'ior', which pop two
word-length operands from the stack, perform the logical operation on
them and push one word-length result back onto the stack; the 'flt2'
conversion operator, which does the same thing as the 'flt' operator
(see below) except it operates on the word </span></span></font><font size="3"><i><span style="font-weight: normal;">underneath</span></i></font><font size="3"><span style="font-style: normal;"><span style="font-weight: normal;">
the operand which is on the TOS; and finally, 'inot' which is a
monadic Boolean operator which computes the complement of the
word-length value on the TOS.</span></span></font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">Row 5 has the five dyadic
integer operators corresponding to the '+', '-', '*', 'DIV', and
'MOD' Pascal operators. The other three opcodes in that row perform
the monadic integer negation of the word on the TOS ('negi'); and
taking the absolute value or square of the integer operand on the TOS
('absi' and 'sqri').</font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">Row 6 has the
corresponding &#8220;real&#8221; operators for everything in row 5 except
'modi', since there is no &#8220;real&#8221; counterpart for that. The last
opcode in row 6 is 'flt', which pops the word-length integer on the
TOS, converts it to a two-word real and pushes that onto the stack.</font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">Row 7 has the two opcodes
'trc' and 'rnd', which implement the Pascal functions 'trunc' and
'round'. The next two opcodes 'incw' and 'decw' increment or
decrement the word on the TOS by a constant. The final four opcodes
increment or decrement a word in memory by one; the word is located
in either global space or the local stack frame.</font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">Row 8 has opcodes for the
six relational operators (the two word-length integer operands are
popped from the stack, compared, and the result of the compare is
pushed onto the TOS. The seventh opcode ('inn') implements the Pascal
'IN' set membership test. The eighth opcode 'dif' is a dyadic set
difference operator.</font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">The first six opcodes in
row 9 are the multi-byte comparison versions of those in row 8. The
final two opcodes 'sst1' and 'sst2' do the subset tests s1 &lt;= s2
and s1 &gt;= s2.</font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">In row 10,</font></p>
<p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">'tjp': (conditional) jump
on true: pop TOS; branch to label if popped word is non-zero</font></p>
<p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">'ujc': error case entry;
causes program abort when there is no case label for case index</font></p>
<p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">'xjp': indexed jump used
in regular (non-sparse) case statements</font></p>
<p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">'sjp'; sparse case
statement search-and-jump (# of cases &lt; 25% of (hi &#8211; low) label
span)</font></p>
<p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">'cas': case range check:
if case index (on the TOS) is less than the lowest case label, or
greater than the highest case label, then report an error</font></p>
<p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">'chk0': checks a pointer
which on the TOS (waiting to be assigned); reports an error if the
pointer is undefined (is not NIL, and doesn't point to an allocated
variable)</font></p>
<p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">'chk1': checks a pointer
which is on the TOS (waiting to be de-referenced); reports an error
if the pointer does not point to an allocated variable in the heap,
or is NIL.</font></p>
<p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">'chk2': checks the value
of a word on the TOS: the word must be in the closed interval of the
two constants following the opcode</font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">In row 11,</font></p>
<p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">'ixa': ('index array')
does the address calculation of an array plus subscript: the TOS word
is an index with the (compile-time) lower bound already subtracted;
the TOS-1 word is the array base. ixa multiplies the adjusted
subscript by the 'stride' (row/element size, an encoded, compile-time
constant following the opcode) and adds that value into the array
base. The subscript is popped, and the address of the indexed array
is left on the TOS. For ixa (and the following ixca), the loading of
subscript values (and additional descriptors) and another execution
of this instruction may have to be repeated for multidimensional
arrays.</font></p>
<p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">'ixca': ('index
conformant array') does the address calculation of a conformant array
plus subscript. The TOS-2 word is the conformant array parameter
(address of VAR array passed in, or address of copy made of value
conformant array); the TOS-1 word is the subscript (unadjusted); and
the TOS word is the address of the descriptor for the conformant
array parameter (list) passed as a separate argument. This descriptor
contains the low bound value, the high bound value, and the 'stride'
(length of the element/row). The ixca opcode 1) pops the three words
on the TOS; 2) checks the value of the subscript against the low and
high bound range; 3) subtracts the low bound from the subscript; 4)
multiplies the adjusted subscript by the 'stride'; and 5) adds that
product into the array base, yielding the address of the indexed
array (element or row); and 6) pushes that address onto the TOS.</font></p>
<p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">'iodd': is a monadic
integer operator that implements Pascal's 'odd' function. It replaces
the integer argument on the TOS with the appropriate Boolean value.</font></p>
<p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">'fjp': (conditional)
branch on false: pops the TOS word and branches if it is zero (false)</font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">In row 12:</font></p>
<p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">'eofp': this implements
the 'eof' standard function. The TOS word is a file channel number. A
run-time check is made to see if the indicated file is open. The file
channel number is replaced by the Boolean value which is the result
of the function. This is unmodified from the P5 implementation.</font></p>
<p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">'sgs': this pops the TOS
word and pushes a (32-byte) singleton set of that word.</font></p>
<p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">'rgs': this pops the two
words on the TOS, and pushes the set [ el1..el2 ] onto the stack. The
'sgs' and 'rgs' opcodes are unmodified from the the P5
implementation.</font></p>
<p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">'bra': unconditional branch
to the indicated label</font></p>
<p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">'ipj': this is the
'inter-procedural jump' that implements a GOTO instruction whose
target label is in an enclosing procedure. The static link is updated
by following the chain of static links back the appropriate number of
levels. The TOS is restored to the value that was in effect when that
procedure activation called the locally declared procedure that
contained (or indirectly contained) the GOTO instruction (so that any
value conformant array parameter that was copied, is still
preserved). This is a modified version of the P5 implementation.</font></p>
<p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">'dmp': pops the word on
the TOS. This is unmodified from the P5 implementation.</font></p>
<p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">'dup': this is new to P6.
It duplicates (pushes a copy of) the word on the TOS. A minor
optimization to prevent a memory re-load.</font></p>
<p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">'swp': swap the n bytes
on the TOS with the word underneath. This is unmodified from P5.</font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">In row 13,</font></p>
<p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">'cal' calls a
user-declared procedure. The lexical level and offset to the entry
point of the target procedure are encoded in the instruction. (The
old name was 'cup'.)</font></p>
<p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">'cali' calls a
user-declared procedure that was passed as a parameter. The
entry-point address and the lexical level pointer must have been
pushed onto the TOS.</font></p>
<p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">'csp' calls a standard
(pre-declared) procedure.</font></p>
<p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">'mst' creates a 20-byte
stack mark. This is the old-fashioned way of keeping track of static
links, dynamic links, return addresses and function results. This is
slated to be overhauled in the v2.0 release, to use a more modern
structure.</font></p>
<p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">'ent' adds a compile-time
constant to the stack pointer (SP) thereby allocating space for a
procedure's locally-declared variables.</font></p>
<p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">'ret0' branches to the
saved return address, restoring the saved frame pointer and the TOS
pointer.</font></p>
<p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">'ret1' does the same
thing as ret0, except that the one-word function result is on the TOS</font></p>
<p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">'ret2' does the same
thing as ret0, except that the two-word (presumably &#8220;real&#8221;)
function result is on the TOS</font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">In row 14,</font></p>
<p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">'mov' pops the
destination and then source addresses from the stack, and copies the
source operand to the destination address for the number of bytes
encoded after the opcode</font></p>
<p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">'copy' is used in the
prologue code of a procedure declaring a 'value conformant array
parameter' to copy that array into the frame space of that procedure
activation. Two items must have been pushed onto the stack prior to
the execution of the 'copy'. The first is the size of the array,
computed by the callee's prologue code by evaluating (high bound &#8211;
low bound + 1)*stride. These values are available at run-time in the
conformant array descriptor. The second item is the address of the
the conformant array parameter (so this is the address of the address
of the array). So then 'copy'</font></p>

<p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
    <font size="3">1. pops the address
and then the size</font></p><p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left"><font size="3">2. de-references the
address of the address to get the address of the actual array arg</font></p>
<p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
    <font size="3">3. copies the actual
array argument to SP for 'size'</font></p>
<p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
    <font size="3">4. stores SP into
popped address (to point the formal param at the copy)</font></p>
<p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
    <font size="3">5. updates SP using
'size' to include copied actual array in stack frame.</font></p>
<p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
    <font size="3">(Interpreters don't
have to worry about intervening interrupts! A native-code generator
would have to save the SP into a temp, do #5 first, then do #s 3 and
4, or risk intermittent errors.)</font></p>

<p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">'fbv', 'fvb', and 'efb'
are taken unmodified from P5, as well as 'pack' and 'unpk'. The first
two validate file buffers for textfiles and non-text files. The
second tests for eof on non-text files. The opcodes 'pack' and 'unpk'
implement the pre-declared procedures 'pack' and 'unpack' (which are
relics of the CDC 6000 era).</font></p>
<p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">'pop0' is new to P6. It
is used to test for the loss of set elements when a larger set is
assigned to a smaller set, via the stack.</font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">In row 15 (the final row,
whew!)</font></p>
<p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">'cmln' copies the command
line that invokes the program execution into a PACKED ARRAY [1..256]
pointed to by the program parameter 'commandLine'</font></p>
<p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">'asgn' does an 'assign'
of the program parameter name (but not 'input', 'output', or
'commandline') with '.txt' appended, to an external textfile.</font></p>
<p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">'srcl' is taken from the
P5 implementation, for use in source-line level execution tracing.</font></p>
<p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">'fatl' is generated by
the compiler to mark the p-code file as unexecutable. It is used in
the event that the compiler detects one or more fatal errors.
(Warnings do not count.)</font></p>
<p style="margin-left: 0.6in; text-indent: -0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">'stop' tells the
interpreter to stop interpreting.</font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">The opcode 'lastop' ,
like 'invd', is never generated. It is declared in the enumeration so
that the interpreter can use the construction &#8220;FOR op := succ(invd)
TO pred(lastop) DO&#8221; to process generated opcodes without having to
worry about additions, deletions, or re-ordering.</font></p><p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left"><font size="3"></font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; page-break-before: always; font-family: Arial;" align="center"><big>
<font size="4"><big><b>Appendix B. Conformant
Array Parameters</b></big></font></big></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">This appendix provides a
description of the implementation of 'conformant array parameters',
which is what distinguishes level 1 from level 0 of the ISO/IEC 7185
standard.</font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">To motivate this,
consider a procedure written in Pascal (without extensions) that does
vector addition:<br></font></p>

<font style="font-family: Courier New;" size="3">CONST lobound = 1;
hibound = 10;</font><span style="font-family: Courier New;">
</span><br style="font-family: Courier New;">
<font style="font-family: Courier New;" size="3">TYPE  &nbsp;indexTyp =
lobound..hibound;</font><span style="font-family: Courier New;">
</span><br style="font-family: Courier New;">
      <font style="font-family: Courier New;" size="3">&nbsp; &nbsp; &nbsp; arrayTyp =
ARRAY [indexTyp] OF real;</font><span style="font-family: Courier New;"></span><br><br style="font-family: Courier New;">
<font style="font-family: Courier New;" size="3">PROCEDURE vecAdd(VAR
op1,op2,rslt: arrayTyp);</font><span style="font-family: Courier New;">
</span><br style="font-family: Courier New;">
<font style="font-family: Courier New;" size="3">BEGIN</font><span style="font-family: Courier New;">
</span><br style="font-family: Courier New;">
  <font style="font-family: Courier New;" size="3">&nbsp; FOR i := lobound
TO hibound DO</font><span style="font-family: Courier New;">
</span><br style="font-family: Courier New;">
    <font style="font-family: Courier New;" size="3">&nbsp; &nbsp; rslt[i] :=
op1[i] + op2[i]</font><span style="font-family: Courier New;">
</span><br style="font-family: Courier New;">
<font style="font-family: Courier New;" size="3">END;</font><span style="font-family: Courier New;">
</span><br style="font-family: Courier New;">
<br style="font-family: Courier New;">


<font style="font-family: Courier New;" size="3">PROCEDURE p(VAR
a,b,c: arrayTyp);</font><span style="font-family: Courier New;">
</span><br style="font-family: Courier New;">
<font style="font-family: Courier New;" size="3">BEGIN</font><span style="font-family: Courier New;">
</span><br style="font-family: Courier New;">
  <font style="font-family: Courier New;" size="3">&nbsp; vecAdd(a, b, c);</font><span style="font-family: Courier New;">
</span><br style="font-family: Courier New;">
<font style="font-family: Courier New;" size="3">END;</font>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3"><span style="font-style: normal;"><span style="font-weight: normal;">Now
consider that within the same program that provides this 'vecAdd'
procedure, there is also the need to add vectors with </span></span></font><font size="3"><i><span style="font-weight: normal;">fifty</span></i></font><font size="3"><span style="font-style: normal;"><span style="font-weight: normal;">
elements. How do you modify 'vecAdd' to handle that? After you make
that modification, can 'vecAdd' still handle vectors with ten
elements? This was seen as the single biggest limitation in the
original Pascal design. The language seemed to be ill-suited for
writing libraries of numerical algorithms. To handle different sizes
of vectors and matrices, you have to make copies of the same code but
with different constants.</span></span></font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3"><span style="font-style: normal;"><span style="font-weight: normal;">What
finally emerged from the International Standards Organization (ISO)
was a document which codified the existing language (while fixing a
'hole' in the passing of procedures as parameters). It also offered a
solution to the above problem while doing the least amount of change
to existing constructs: the conformant array parameter. Nevertheless,
it was considered so controversial that several members of ISO
threatened a 'no' vote if conformant array parameters were included
in the standard. Other members threatened a 'no' vote if they were
</span></span></font><font size="3"><i><span style="font-weight: normal;">excluded</span></i></font><font size="3"><span style="font-style: normal;"><span style="font-weight: normal;">
from the standard. Finally, a great compromise was hammered out:
there would be a 'level 0' compliance for processors and programs
that did not include the new feature, and a 'level 1' compliance for
those that did.</span></span></font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">The designer of Pascal,
Prof. Niklaus E. Wirth, who had by that time designed and implemented
a couple of new languages, Modula and Modula-2, endorsed the new
feature.</font></p><p style="text-indent: 0.2in; margin-bottom: 0in; font-style: normal; font-family: Arial;" align="left">
<font size="3">Using conformant array
parameters, the above example could be recoded as:</font></p><p style="text-indent: 0.2in; margin-bottom: 0in; font-style: normal; font-family: Arial;" align="left"><br>
</p>

<font style="font-family: Courier New;" size="3">TYPE &nbsp;index =
1..100;</font><span style="font-family: Courier New;">
<br></span><font style="font-family: Courier New;" size="3">&nbsp; &nbsp; &nbsp; arrayTyp =
ARRAY [index] OF real;</font><span style="font-family: Courier New;">
</span><br style="font-family: Courier New;">
      <font style="font-family: Courier New;" size="3">&nbsp; &nbsp; &nbsp; smallAry =
ARRAY [1..10] OF real;</font><span style="font-family: Courier New;">
</span><br style="font-family: Courier New;">
<br style="font-family: Courier New;">


<font style="font-family: Courier New;" size="3">PROCEDURE vecAdd(VAR
op1,op2,rslt:</font><span style="font-family: Courier New;">
</span><font style="font-family: Courier New;" size="3">ARRAY
[lobound..hibound: index] OF real);</font><span style="font-family: Courier New;">
</span><br style="font-family: Courier New;">
  <font style="font-family: Courier New;" size="3">&nbsp; VAR   i: index;</font><span style="font-family: Courier New;">
</span><br style="font-family: Courier New;">
<font style="font-family: Courier New;" size="3">BEGIN</font><span style="font-family: Courier New;">
</span><br style="font-family: Courier New;">
  <font style="font-family: Courier New;" size="3">&nbsp; FOR i := lobound
TO hibound DO</font><span style="font-family: Courier New;">
</span><br style="font-family: Courier New;">
    <font style="font-family: Courier New;" size="3">&nbsp; &nbsp; rslt[i] :=
op1[i] + op2[i]</font><span style="font-family: Courier New;">
</span><br style="font-family: Courier New;">
<font style="font-family: Courier New;" size="3">END;</font><span style="font-family: Courier New;">
</span><br style="font-family: Courier New;">
<br style="font-family: Courier New;">


<font style="font-family: Courier New;" size="3">PROCEDURE p(VAR
a,b,c: arrayTyp);</font><span style="font-family: Courier New;">
</span><br style="font-family: Courier New;">
<font style="font-family: Courier New;" size="3">BEGIN</font><span style="font-family: Courier New;">
</span><br style="font-family: Courier New;">
  <font style="font-family: Courier New;" size="3">&nbsp; vecAdd(a, b, c);</font><span style="font-family: Courier New;">
</span><br style="font-family: Courier New;">
<font style="font-family: Courier New;" size="3">END;</font><span style="font-family: Courier New;">
</span><br style="font-family: Courier New;">
<br style="font-family: Courier New;">


<font style="font-family: Courier New;" size="3">{ and for good
measure, the following declaration is also legal }</font><span style="font-family: Courier New;">
</span><br style="font-family: Courier New;">
<font style="font-family: Courier New;" size="3">{ and shows the
flexibility of the conformant array parameter }</font><span style="font-family: Courier New;">
</span><br style="font-family: Courier New;">
<font style="font-family: Courier New;" size="3">PROCEDURE q(VAR
d,e,f: smallAry);</font><span style="font-family: Courier New;">
</span><br style="font-family: Courier New;">
<font style="font-family: Courier New;" size="3">BEGIN</font><span style="font-family: Courier New;">
</span><br style="font-family: Courier New;">
  <font style="font-family: Courier New;" size="3">&nbsp; vecAdd(d, e, f);</font><span style="font-family: Courier New;">
</span><br style="font-family: Courier New;">
<font style="font-family: Courier New;" size="3">END;</font>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">The reason for making the
operand vectors VAR parameters is the same in both examples: the
procedure vecAdd does not assign into the parameters, and making the
arrays VAR parameters keeps the run-time code from having to make
copies of the arrays. (Another reason is simplicity. The 'rslt'
parameter needs to be a VAR parameter, so that results are
transmitted back to the calling procedure(s); if the operands op1 and
op2 are passed as value conformant array parameters, that would
require a whole additional conformant array specification with a
whole new pair of index bound identifiers. That could lead to
confusion.)</font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">By the way, a note within
the standard says that a bound identifier (e.g., 'lobound',
'hibound') denotes &#8220;neither a constant nor a variable&#8221;. It is not
a variable, because it cannot be assigned into, read into, or passed
as a VAR parameter. It is not a constant because its value is not
known at compile-time. It can, however be used as a primary in an
expression, thus its use in the FOR loop in the above example. It is
a new kind of 'object'.</font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-family: Arial;" align="left">
<font size="3"><span style="font-style: normal;"><span style="font-weight: normal;">Simple
inspection of the 'vecAdd' procedure will reveal to the alert
programmer, that not only does the caller pass in the addresses of
'op1', 'op2' and 'rslt', but also passes the values of 'lobound' and
'hibound'. What is not so obvious is that for efficiency reasons, the
caller also passes in the 'stride', i.e., the size in bytes of the
element(/sub-row), along with each pair of bounds. Since the example
uses a one-dimensional array, it is not obvious why the caller should
go to this trouble since the stride in this case is simply the
byte-length of 'real', or 8. The callee could calculate the stride
for each dimension, but where would it 'remember' the calculated
value? The straightforward answer is to store it with the bound pair.
Such a triplet is called an array descriptor. (If the array is
n-dimensional, then the n triplets, plus the address of the array, is
known as the </span></span></font><font size="3"><i><span style="font-weight: normal;">dope
vector</span></i></font><font size="3"><span style="font-style: normal;"><span style="font-weight: normal;">.)</span></span></font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">So in the above example,
the caller passes three addresses for 'op1', 'op2' and 'rslt', and it
also passes an array descriptor for the three arrays. (These arrays
share the same descriptor, since the standard requires that all the
arrays in an identifier list of a conformant array specification be
of identical type.) Therefore, the caller passes three addresses, and
three integers, for a total of twenty-four bytes of arguments. At the
beginning of a call chain with conformant array parameters, there is
always an actual argument which is a declared array variable. The
strides for each dimension are calculated by the compiler at
compile-time. So if the caller in each leg of the call chain passes
the bounds and stride to the parameters at the next stage, then the
stride need never be calculated at run-time at all.</font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
<font size="3">(As a colleague back at 
the Burroughs Medium Systems plant in Pasadena once remarked,
regarding the implementation of arrays in BPL, Burroughs Programming
Language:)</font></p>
<p style="text-indent: 0.2in; margin-top: 0.2in; margin-bottom: 0in; font-style: normal; font-weight: normal; font-family: Arial;" align="left">
&#8220;<font size="3">Array! Array! The
indices are here!&#8221;</font></p></body></html>